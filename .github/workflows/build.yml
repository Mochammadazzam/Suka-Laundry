name: Build Suka Laundry Pro - Master Reference
on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # Menggunakan referensi marketplace yang disebutkan di PDF Anda (Henryhale)
      # Ini adalah 'resep' yang sudah terbukti berhasil untuk Capacitor
      - name: Build Android via Henryhale Reference
        uses: henryhale/android-capacitor@v2
        with:
          npm-install-args: --legacy-peer-deps

      - name: Auto-Config & Protection
        run: |
          # Menyuntikkan standar Bluetooth LE (halaman 12 PDF)
          sed -i '/<application/i \    <uses-permission android:name="android.permission.BLUETOOTH_SCAN" />\n    <uses-permission android:name="android.permission.BLUETOOTH_CONNECT" />\n    <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />' android/app/src/main/AndroidManifest.xml
          
          # Aktifkan Proteksi Kode (Anti-Decompile)
          sed -i 's/minifyEnabled false/minifyEnabled true/g' android/app/build.gradle

      - name: Build Final APK
        run: |
          cd android
          ./gradlew assembleDebug

      - name: Save Result
        uses: actions/upload-artifact@v4
        with:
          name: SukaLaundryPro-Success-Build
          path: android/app/build/outputs/apk/debug/app-debug.apk
